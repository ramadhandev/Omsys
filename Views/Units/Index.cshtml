@model IEnumerable<OMSys.Models.Unit>

@{
    ViewData["Title"] = "Units";
}

<div class="card shadow-sm">
    <div class="card-header bg-light fw-bold d-flex justify-content-between align-items-center">
        <div><i class="bi bi-list-ul"></i> Units List</div>
        <a asp-action="Create" class="btn btn-sm btn-primary">
            <i class="bi bi-plus-circle"></i> Create New
        </a>
    </div>
    <div class="card-body">
        <!-- 1. Filter Search + Dropdown -->
        <form method="get" class="mb-3">
            <div class="input-group">
                <input type="text" name="search" value="@ViewBag.Search" class="form-control" placeholder="Search by name, brand, type..." />

                <!-- Brand Filter Dropdown -->
                <select name="brandFilter" class="form-select">
                    <option value="">All Brands</option>
                    @foreach (var b in ViewBag.BrandList)
                    {
                        if (b == ViewBag.BrandFilter)
                        {
                            <option value="@b" selected>@b</option>
                        }
                        else
                        {
                            <option value="@b">@b</option>
                        }
                    }
                </select>

                <!-- Type Filter Dropdown -->
                <select name="typeFilter" class="form-select">
                    <option value="">All Types</option>
                    @foreach (var t in ViewBag.TypeList)
                    {
                        if (t == ViewBag.TypeFilter)
                        {
                            <option value="@t" selected>@t</option>
                        }
                        else
                        {
                            <option value="@t">@t</option>
                        }
                    }
                </select>

                <button type="submit" class="btn btn-outline-secondary">Filter</button>
            </div>
        </form>

        <!-- 2. Bulk Delete -->
        <form asp-action="BulkDelete" method="post" onsubmit="return confirm('Are you sure you want to delete selected units?');">
            <p>
                <button type="submit" class="btn btn-sm btn-danger">
                    <i class="bi bi-trash"></i> Delete Selected
                </button>
            </p>

            <!-- 3. Table -->
            <table class="table table-striped table-hover align-middle">
                <thead class="table-secondary">
                    <tr>
                        <th><input type="checkbox" id="select-all" /></th>
                        <th>@Html.DisplayNameFor(model => model.UnitName)</th>
                        <th>@Html.DisplayNameFor(model => model.Brand)</th>
                        <th>@Html.DisplayNameFor(model => model.Type)</th>
                        <th style="width:150px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model ?? Enumerable.Empty<OMSys.Models.Unit>())
                    {
                        <tr>
                            <td><input type="checkbox" name="selectedIds" value="@item.UnitId" /></td>
                            <td>@(item.UnitName ?? "-")</td>
                            <td>@(item.Brand ?? "-")</td>
                            <td>@(item.Type ?? "-")</td>
                            <td>
                                <a asp-action="Edit" asp-route-id="@item.UnitId" class="btn btn-sm btn-warning text-white">
                                    <i class="bi bi-pencil-square"></i> Edit
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.UnitId" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i> Delete
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </form>

        <!-- 4. Pagination -->
        <nav>
            <ul class="pagination">
                @{
                    int currentPage = ViewBag.Page ?? 1;
                    int totalPages = ViewBag.TotalPages ?? 1;
                    string search = ViewBag.Search ?? "";
                    string brand = ViewBag.BrandFilter ?? "";
                    string type = ViewBag.TypeFilter ?? "";
                }

                <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                    <a class="page-link" href="?search=@search&brandFilter=@brand&typeFilter=@type&page=@(currentPage - 1)">Previous</a>
                </li>

                @for (int i = 1; i <= totalPages; i++)
                {
                    <li class="page-item @(i == currentPage ? "active" : "")">
                        <a class="page-link" href="?search=@search&brandFilter=@brand&typeFilter=@type&page=@i">@i</a>
                    </li>
                }

                <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                    <a class="page-link" href="?search=@search&brandFilter=@brand&typeFilter=@type&page=@(currentPage + 1)">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

@section Scripts {
    <script src="~/js/Custom.js"></script>
    
}
